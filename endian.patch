diff --git a/src/util/serialize.h b/src/util/serialize.h
index 7990779..1738a72 100644
--- a/src/util/serialize.h
+++ b/src/util/serialize.h
@@ -23,7 +23,7 @@ with this program; if not, write to the Free Software Foundation, Inc.,
 #include "../irrlichttypes_bloated.h"
 #include "config.h"
 #if HAVE_ENDIAN_H
-#include <endian.h>
+#include "portable_endian.h"
 #include <string.h> // for memcpy
 #endif
 #include <iostream>
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 13e9006..d7b34a4 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -248,15 +248,25 @@ else()
 		set(PLATFORM_LIBS "-framework CoreFoundation" ${PLATFORM_LIBS})
 	else()
 		set(PLATFORM_LIBS -lrt ${PLATFORM_LIBS})
+		#set(CLIENT_PLATFORM_LIBS -lXxf86vm)
+		# This way Xxf86vm is found on OpenBSD too
+		find_library(XXF86VM_LIBRARY Xxf86vm)
+		mark_as_advanced(XXF86VM_LIBRARY)
+		set(CLIENT_PLATFORM_LIBS ${CLIENT_PLATFORM_LIBS} ${XXF86VM_LIBRARY})
 	endif(APPLE)
-	#set(CLIENT_PLATFORM_LIBS -lXxf86vm)
-	# This way Xxf86vm is found on OpenBSD too
-	find_library(XXF86VM_LIBRARY Xxf86vm)
-	mark_as_advanced(XXF86VM_LIBRARY)
-	set(CLIENT_PLATFORM_LIBS ${CLIENT_PLATFORM_LIBS} ${XXF86VM_LIBRARY})
 endif()
 
-check_include_files(endian.h HAVE_ENDIAN_H)
+if(APPLE)
+    set(ENDIAN_H "machine/endian.h")
+else()
+    if(FreeBSD)
+        set(ENDIAN_H "sys/endian.h")
+    else()
+        set(ENDIAN_H "endian.h")
+    endif(FreeBSD)
+endif(APPLE)
+check_include_files(${ENDIAN_H} HAVE_ENDIAN_H)
+
 
 configure_file(
 	"${PROJECT_SOURCE_DIR}/cmake_config.h.in"

